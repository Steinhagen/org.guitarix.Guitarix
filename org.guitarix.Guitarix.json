{
  "app-id": "org.guitarix.Guitarix",
  "branch": "19.08",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "19.08",
  "sdk": "org.freedesktop.Sdk",
  "command": "guitarix",
  "rename-desktop-file": "guitarix.desktop",
  "rename-icon": "gx_head",
  "finish-args": [
    /* X11 + XShm access */
    "--share=ipc",
    "--socket=x11",
    /* Wayland */
    "--socket=wayland",
    /* Note playback */
    "--socket=pulseaudio",
    /* MIDI */
    "--device=all",
    "--device=shm",
    /* Allow loading, saving files from anywhere (portals donâ€™t work yet) */
    "--filesystem=host",
    /* Allow other instances to see lockfiles */
    "--env=TMPDIR=/var/tmp",
    "--env=LV2_PATH=/app/extensions/Lv2Plugins/lv2:/app/lv2",
    "--env=DSSI_PATH=/app/extensions/DssiPlugins/dssi",
    "--env=VST_PATH=/app/extensions/VstPlugins/lxvst",
    "--env=LXVST_PATH=/app/extensions/VstPlugins/lxvst",
    "--env=VST3_PATH=/app/extensions/Vst3Plugins/vst3",
    "--env=LADSPA_PATH=/app/extensions/LadspaPlugins/ladspa"
  ],
  "cleanup": [
    "/share/man",
    "/share/doc",
    "/share/info",
    "/share/gtk-doc",
    "/include",
    "*.la"
  ],
  "add-extensions": {
    "org.freedesktop.LinuxAudio.Lv2Plugins": {
      "directory": "extensions/Lv2Plugins",
      "version": "19.08",
      "add-ld-path": "lib",
      "merge-dirs": "lv2",
      "subdirectories": true,
      "no-autodownload": true,
      "autodelete": true
    },
    "org.freedesktop.LinuxAudio.Lv2Plugins.Guitarix": {
      "directory": "extensions/Lv2Plugins/Guitarix",
      "branch": "19.08",
      "add-ld-path": "lib",
      "bundle": true,
      "autodelete": false
    },
    "org.freedesktop.LinuxAudio.DssiPlugins": {
      "directory": "extensions/DssiPlugins",
      "version": "19.08",
      "add-ld-path": "lib",
      "merge-dirs": "dssi",
      "subdirectories": true,
      "no-autodownload": true,
      "autodelete": true
    },
    "org.freedesktop.LinuxAudio.LadspaPlugins": {
      "directory": "extensions/LadspaPlugins",
      "version": "19.08",
      "add-ld-path": "lib",
      "merge-dirs": "ladspa",
      "subdirectories": true,
      "no-autodownload": true,
      "autodelete": true
    },
    "org.freedesktop.LinuxAudio.VstPlugins": {
      "directory": "extensions/VstPlugins",
      "version": "19.08",
      "add-ld-path": "lib",
      "merge-dirs": "lxvst",
      "subdirectories": true,
      "no-autodownload": true,
      "autodelete": true
    },
    "org.freedesktop.LinuxAudio.Vst3Plugins": {
      "directory": "extensions/Vst3Plugins",
      "version": "19.08",
      "add-ld-path": "lib",
      "merge-dirs": "vst3",
      "subdirectories": true,
      "no-autodownload": true,
      "autodelete": true
    }
  },
  "modules": [
    "gtk2.json",
    {
      "name": "boost",
      "buildsystem": "simple",
      "cleanup": [
        "/include",
        "*.a"
      ],
      "build-commands": [
        "./bootstrap.sh --with-libraries=system,iostreams",
        "./b2 install variant=release link=shared runtime-link=shared --prefix=/app -j $FLATPAK_BUILDER_N_JOBS"
      ],
      "cleanup": [
        "*.so"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://downloads.sourceforge.net/project/boost/boost/1.60.0/boost_1_60_0.tar.bz2",
          "sha256": "686affff989ac2488f79a97b9479efb9f2abae035b5ed4d8226de6857933fd3b"
        }
      ]
    },
    "shared-modules/linux-audio/jack2.json",
    "shared-modules/linux-audio/fftw3f.json",
    {
      "name": "zita-convolver",
      "buildsystem": "simple",
      "build-commands": [
        "make -C source PREFIX=/app LIBDIR=/app/lib -j  $FLATPAK_BUILDER_N_JOBS",
        "make -C source PREFIX=/app LIBDIR=/app/lib install"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "http://kokkinizita.linuxaudio.org/linuxaudio/downloads/zita-convolver-4.0.3.tar.bz2",
          "sha256": "9aa11484fb30b4e6ef00c8a3281eebcfad9221e3937b1beb5fe21b748d89325f"
        },
        {
          "type": "patch",
          "path": "zita-convolver-make.patch"
        }
      ]
    },
    {
      "name": "zita-resampler",
      "buildsystem": "simple",
      "build-commands": [
        "make -C source PREFIX=/app LIBDIR=/app/lib -j  $FLATPAK_BUILDER_N_JOBS",
        "make -C source PREFIX=/app LIBDIR=/app/lib install"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "http://kokkinizita.linuxaudio.org/linuxaudio/downloads/zita-resampler-1.6.2.tar.bz2",
          "sha256": "233baefee297094514bfc9063e47f848e8138dc7c959d9cd957b36019b98c5d7"
        },
        {
          "type": "patch",
          "path": "zita-resampler-make.patch"
        }
      ]
    },
    "shared-modules/linux-audio/lrdf.json",
    "shared-modules/linux-audio/lv2.json",
    "shared-modules/linux-audio/lilv.json",
    {
      "name": "eigen",
      "builddir": true,
      "buildsystem": "cmake-ninja",
      "cleanup": [
        "/share"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "http://bitbucket.org/eigen/eigen/get/3.3.5.tar.gz",
          "sha256": "0454b6bacafd2bf641e0fb0f59572b9995728b77e41d1b8517f807334d07e68e"
        }
      ]
    },
    {
      "name": "guitarix",
      "buildsystem": "simple",
      "build-commands": [
        "ln -sf /usr/bin/python3 $FLATPAK_DEST/bin/python",
        "python3 ./waf configure --prefix=$FLATPAK_DEST --lv2dir=${FLATPAK_DEST}/extensions/Lv2Plugins/Guitarix/lv2 --ldflags=-L$FLATPAK_DEST/lib --no-avahi --no-bluez --install-roboto-font --no-faust",
        "python3 ./waf build -j $FLATPAK_BUILDER_N_JOBS",
        "python3 ./waf install"
      ],
      "cleanup": [
        "/bin/python"
      ],
      "post-install": [
        "install -Dm644 -t $FLATPAK_DEST/share/icons/hicolor/128x128/apps $FLATPAK_DEST/share/pixmaps/gx_head.png",
        "install -Dm644 -t $FLATPAK_DEST/share/appdata org.guitarix.Guitarix.appdata.xml",
        "install -d /app/extensions/Lv2Plugins",
        "install -d /app/extensions/LadspaPlugins",
        "install -d /app/extensions/DssiPlugins",
        "install -d /app/extensions/VstPlugins",
        "install -d /app/extensions/Vst3Plugins",
        "install -d /app/extensions/Lv2Plugins/Guitarix",
        "cp -a /app/lib /app/extensions/Lv2Plugins/Guitarix/",
        "install -Dm644 -t /app/extensions/Lv2Plugins/Guitarix/share/metainfo org.freedesktop.LinuxAudio.Lv2Plugins.Guitarix.metainfo.xml",
        "appstream-compose --basename=org.freedesktop.LinuxAudio.Lv2Plugins.Guitarix --prefix=/app/extensions/Lv2Plugins/Guitarix --origin=flatpak org.freedesktop.LinuxAudio.Lv2Plugins.Guitarix"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://downloads.sourceforge.net/project/guitarix/guitarix/guitarix2-0.39.0.tar.xz",
          "sha256": "490ff3f856282f776456b8e27366dd074d663870c0a89fccded03d854305c8da"
        },
        {
          "type": "file",
          "path": "org.guitarix.Guitarix.appdata.xml"
        },
        {
          "type": "file",
          "path": "org.freedesktop.LinuxAudio.Lv2Plugins.Guitarix.metainfo.xml"
        }
      ]
    }
  ]
}
