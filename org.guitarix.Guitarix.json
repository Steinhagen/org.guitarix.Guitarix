{
    "app-id": "org.guitarix.Guitarix",
    "branch": "19.08",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "19.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "guitarix",
    "rename-desktop-file": "guitarix.desktop",
    "rename-icon": "gx_head",
    "finish-args": [
        /* X11 + XShm access */
        "--share=ipc",
        "--socket=x11",
        /* Wayland */
        "--socket=wayland",
        /* Note playback */
        "--socket=pulseaudio",
        /* MIDI */
        "--device=all",
        "--device=shm",
        /* Allow loading, saving files from anywhere (portals donâ€™t work yet) */
        "--filesystem=host",
        /* Allow other instances to see lockfiles */
        "--env=TMPDIR=/var/tmp",
        "--env=LV2_PATH=/app/extensions/Plugins/lv2:/app/extensions/Lv2Plugins/lv2",
        "--env=LADSPA_PATH=/app/extensions/Plugins/ladspa:/app/extensions/LadspaPlugins/ladspa"
    ],
    "cleanup": [
        "/bin/jack*",
        "/lib/cmake",
        "/lib/lv2",
        "/lib/pkgconfig",
        "/lib/python-3.7",
        "/share/man",
        "/share/doc",
        "/share/info",
        "/share/gtk-doc",
        "/include",
        "*.la",
        "*.a"
    ],
    "add-extensions": {
        "org.freedesktop.LinuxAudio.Plugins": {
            "directory": "extensions/Plugins",
            "version": "19.08",
            "add-ld-path": "lib",
            "merge-dirs": "ladspa;lv2",
            "subdirectories": true,
            "no-autodownload": true,
            "autodelete": false
        },
        "org.freedesktop.LinuxAudio.Plugins.Guitarix": {
            "directory": "extensions/Plugins/Guitarix",
            "branch": "19.08",
            "add-ld-path": "lib",
            "bundle": true,
            "subdirectories": true,
            "no-autodownload": true,
            "autodelete": false
        },
        "org.freedesktop.LinuxAudio.Lv2Plugins": {
            "directory": "extensions/Lv2Plugins",
            "version": "19.08",
            "add-ld-path": "lib",
            "merge-dirs": "lv2",
            "subdirectories": true,
            "no-autodownload": true,
            "autodelete": false
        },
        "org.freedesktop.LinuxAudio.LadspaPlugins": {
            "directory": "extensions/LadspaPlugins",
            "version": "19.08",
            "add-ld-path": "lib",
            "merge-dirs": "ladspa",
            "subdirectories": true,
            "no-autodownload": true,
            "autodelete": false
        }
    },
    "modules": [
        "gtkmm.json",
        "shared-modules/intltool/intltool-0.51.json",
        {
            "name": "boost",
            "buildsystem": "simple",
            "cleanup": [
                "/include",
                "/lib/cmake",
                "*.a"
            ],
            "build-commands": [
                "./bootstrap.sh --with-libraries=system,iostreams",
                "./b2 install variant=release link=shared runtime-link=shared --prefix=/app -j $FLATPAK_BUILDER_N_JOBS"
            ],
            "cleanup": [
                "*.so"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://dl.bintray.com/boostorg/release/1.73.0/source/boost_1_73_0.tar.bz2",
                    "sha256": "4eb3b8d442b426dc35346235c8733b5ae35ba431690e38c6a8263dce9fcbb402"
                }
            ]
        },
        "shared-modules/linux-audio/fftw3f-static.json",
        "shared-modules/linux-audio/lrdf.json",
        "shared-modules/linux-audio/lv2.json",
        "shared-modules/linux-audio/lilv.json",
        {
            "name": "eigen",
            "builddir": true,
            "buildsystem": "cmake-ninja",
            "cleanup": [
                "/share"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://bitbucket.org/eigen/eigen/get/3.3.5.tar.gz",
                    "sha256": "0454b6bacafd2bf641e0fb0f59572b9995728b77e41d1b8517f807334d07e68e"
                }
            ]
        },
        "sassc.json",
        "shared-modules/linux-audio/jack2.json",
        {
            "name": "guitarix",
            "buildsystem": "simple",
            "build-commands": [
                "ln -sf /usr/bin/python3 $FLATPAK_DEST/bin/python",
                "python3 ./waf configure --prefix=$FLATPAK_DEST --lv2dir=${FLATPAK_DEST}/extensions/Plugins/Guitarix/lv2 --ldflags=-L$FLATPAK_DEST/lib --no-avahi --no-bluez --install-roboto-font --no-faust --optimization --includeconvolver --includeresampler",
                "python3 ./waf build -j $FLATPAK_BUILDER_N_JOBS",
                "python3 ./waf install"
            ],
            "cleanup": [
                "/bin/python"
            ],
            "post-install": [
                "install -Dm644 -t $FLATPAK_DEST/share/icons/hicolor/128x128/apps $FLATPAK_DEST/share/pixmaps/gx_head.png",
                "install -Dm644 -t $FLATPAK_DEST/share/appdata org.guitarix.Guitarix.appdata.xml",
                "install -d /app/extensions/Plugins",
                "install -d /app/extensions/Plugins/Guitarix",
                "install -d /app/extensions/LadspaPlugins",
                "install -d /app/extensions/Lv2Plugins",
                "install -Dm644 -t /app/extensions/Plugins/Guitarix/share/metainfo org.freedesktop.LinuxAudio.Plugins.Guitarix.metainfo.xml",
                "appstream-compose --basename=org.freedesktop.LinuxAudio.Plugins.Guitarix --prefix=/app/extensions/Plugins/Guitarix --origin=flatpak org.freedesktop.LinuxAudio.Plugins.Guitarix"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://downloads.sourceforge.net/project/guitarix/guitarix/guitarix2-0.41.0.tar.xz",
                    "sha256": "40951953371d0925b74c9c618b60a76f1e8a65456222837d5b6bac9bb35f4e63"
                },
                {
                    "type": "patch",
                    "path": "guitarix-lv-zita.patch"
                },
                {
                    "type": "file",
                    "path": "org.guitarix.Guitarix.appdata.xml"
                },
                {
                    "type": "file",
                    "path": "org.freedesktop.LinuxAudio.Plugins.Guitarix.metainfo.xml"
                }
            ]
        }
    ]
}
